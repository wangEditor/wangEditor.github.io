/*! wangEditor-mobile.js 2015-11-24 */
!function(a){a.___E_mod=function(b){var c=a.___E;null!=c&&b(c,a.Zepto)}}(window),function(a){var b=a.Zepto,c=a.___E,d="github.com/wangfupeng1988/wangEditor-mobile";if(null!=c){if(c.gitlink===d)return void alert("不得重复引用wangEditor的js文件");if(!c.gitlink||c.gitlink!==d)return void alert("window.___E 属性名已经被其他程序占用。wangEditor-mobile引用失败")}return null==b?void alert("wangEditor-mobile依赖于zepto，请先引用zepto.js"):document.createRange&&"function"==typeof document.createRange?void 0:void alert("当前浏览器不支持document.createRange，不能生成富文本编辑器")}(window),function(a,b){var c="github.com/wangfupeng1988/wangEditor-mobile",d=function(a){var c=this;c.$body=b("body");var d=b("#"+a);c.$textarea=d,c.tapTime=Date.now(),c.checkTapTime=function(){return Date.now()-c.tapTime<100?!1:(c.tapTime=Date.now(),!0)},c.initDefaultConfig(),c.addTxt(),c.addMenus()};d.fn=d.prototype,d.fn.gitlink=c,d.log=function(b,c){a.console?c?console.log(b,c):console.log(b):(alert(b),c&&alert(c))},a.___E=d}(window,window.Zepto),window.___E_mod(function(a,b){a.config={}}),window.___E_mod(function(a,b){a.fn.initDefaultConfig=function(){var a=this;a.config={menuColorValue:"red",menuQuoteStyle:{display:"block","border-left":"5px solid #d0e5f2",padding:"4px 0 4px 10px","background-color":"#f1f1f1",margin:"4px 0"},menus:["head","bold","color","quote","list","check"]}}}),window.___E_mod(function(a,b){a.fn.addTxt=function(){var a=this,c=a.$textarea,d=b.trim(c.val()),e=b('<div contentEditable="true" class="wangEditor-mobile-txt">'+d+"</div>"),f=b('<div class="wangEditor-mobile-modal-container"></div>');a.$txt=e,a.$modalContainer=f,a.insertEmpltyLink()}}),window.___E_mod(function(a,b){a.fn.addMenus=function(){var a,c=this,d=b('<div class="wangEditor-mobile-menu-container"></div>'),e=b('<div class="tip"></div>'),f=b('<div class="close"></div>'),g=b('<a href="#"></a>');d.append(e),g.append(b('<i class="icon-wangEditor-m-close"></i>')),f.append(g),d.append(f);var h=b('<div class="wangEditor-mobile-menu-container-open-btn"><div class="item"><a href="#"><i class="icon-wangEditor-m-ellipsis-h"></i></a></div></div>');h.append(e.clone()),c.$menuContainer=d,c.$menuContainerOpenBtn=h,c.$menuClose=g,c.menus={},a=c.menus,c.addMenuBold("bold"),c.addMenuHead("head"),c.addMenuColor("color"),c.addMenuQuote("quote"),c.addMenuList("list"),c.addMenuCheck("check")}}),window.___E_mod(function(a,b){a.fn.addMenuBold=function(a){var c=this,d=c.menus;d[a]={selected:!1,$trigger:b('<a href="#"><i class="icon-wangEditor-m-bold"></i></a>'),$wrap:b('<div class="item"></div>'),bindEvent:function(a){var b=this;b.$trigger.on("singleTap",function(a){c.checkTapTime()!==!1&&c.command("bold",!1,void 0,a)})},updateStyle:function(a){var b=this,c=b.$trigger;document.queryCommandState("bold")?(b.selected=!0,c.addClass("selected")):(b.selected=!1,c.removeClass("selected"))}}}}),window.___E_mod(function(a,b){a.fn.addMenuHead=function(a){var c=this,d=c.menus||{};d[a]={selected:!1,$trigger:b('<a href="#"><i class="icon-wangEditor-m-header"></i></a>'),$wrap:b('<div class="item"></div>'),bindEvent:function(a){var b=this;b.$trigger.on("singleTap",function(a){c.checkTapTime()!==!1&&(b.selected?c.command("formatblock",!1,"p"):c.command("formatblock",!1,"h3"))})},updateStyle:function(a){var b=this,c=b.$trigger,d=document.queryCommandValue("formatblock");/^h\d{1}$/i.test(d)?(b.selected=!0,c.addClass("selected")):(b.selected=!1,c.removeClass("selected"))}}}}),window.___E_mod(function(a,b){a.fn.addMenuColor=function(a){var c=this,d=c.menus||{},e=c.config.menuColorValue;d[a]={selected:!1,$trigger:b('<a href="#"><i class="icon-wangEditor-m-brush"></i></a>'),$wrap:b('<div class="item"></div>'),bindEvent:function(a){var b=this,d=b.$trigger;d.on("singleTap",function(a){if(c.checkTapTime()!==!1){var d=e;b.selected&&(d="#000"),c.command("forecolor",!1,d,a)}})},updateStyle:function(a){var b=this,c=b.$trigger,d=document.queryCommandValue("forecolor");"rgb(0, 0, 0)"!==d?(b.selected=!0,c.addClass("selected")):(b.selected=!1,c.removeClass("selected"))}}}}),window.___E_mod(function(a,b){a.fn.addMenuQuote=function(a){var c=this,d=c.menus||{},e=(c.$txt,c.config.menuQuoteStyle);d[a]={selected:!1,$trigger:b('<a href="#"><i class="icon-wangEditor-m-quote-left"></i></a>'),$wrap:b('<div class="item"></div>'),bindEvent:function(a){var d=this;d.$trigger.on("singleTap",function(a){if(c.checkTapTime()!==!1){var f,g,h=c.$focusElem;d.selected?(f=h.text(),g=function(){var a=b("<p>"+f+"</p>");h.after(a),h.remove()},c.customCommand(g,a)):(c.command("formatblock",!1,"blockquote",a),c.$txt.find("blockquote").each(function(a,c){var d=b(c),f="w_editor_quote_style",g=d.attr(f);null==g&&(d.css(e),d.attr(f,"1"))}))}})},updateStyle:function(a){var b=this,c=b.$trigger,d=document.queryCommandValue("formatblock");/^blockquote$/i.test(d)?(b.selected=!0,c.addClass("selected")):(b.selected=!1,c.removeClass("selected"))}}}}),window.___E_mod(function(a,b){a.fn.addMenuList=function(a){var c=this,d=c.menus||{};d[a]={selected:!1,$trigger:b('<a href="#"><i class="icon-wangEditor-m-list-ul"></i></a>'),$wrap:b('<div class="item"></div>'),bindEvent:function(a){var b=this;b.$trigger.on("singleTap",function(a){c.checkTapTime()!==!1&&c.command("InsertUnorderedList",!1,void 0,a)})},updateStyle:function(a){var b=this,c=b.$trigger;document.queryCommandState("InsertUnorderedList")?(b.selected=!0,c.addClass("selected")):(b.selected=!1,c.removeClass("selected"))}}}}),window.___E_mod(function(a,b){a.fn.addMenuCheck=function(a){var c=this,d=c.menus||{};d[a]={selected:!1,$trigger:b('<a href="#"><i class="icon-wangEditor-m-checkbox-checked"></i></a>'),$wrap:b('<div class="item"></div>'),bindEvent:function(a){var d=Date.now(),e=this;e.$trigger.on("singleTap",function(a){if(c.checkTapTime()!==!1){var e=b('<input type="checkbox"/>'),f=b("<p></p>");f.append(e).append("&nbsp;&nbsp;"),e.on("singleTap",function(a){if(!(Date.now()-d<50)){d=Date.now();var c=b(a.target),e=c.is(":checked");c.prop("checked",!e),a.preventDefault(),a.stopPropagation()}});var g=function(){c.$focusElem.after(f)};c.customCommand(g,a)}})},updateStyle:function(a){}}}}),window.___E_mod(function(a,b){a.fn.renderTxt=function(){var a=this,b=a.$textarea,c=a.$txt,d=a.$modalContainer,e=a.$body;b.after(c),b.hide(),e.append(d)}}),window.___E_mod(function(a,b){a.fn.renderMenu=function(){var a=this,c=a.menus,d=a.$menuContainer,e=a.$menuContainerOpenBtn,f=(a.$txt,b('<div class="gap"></div>')),g=a.$body,h=a.config.menus;b.each(h,function(a,b){var e=c[b];if(null!=e){var g=e.$trigger,h=e.$wrap;g&&(h?(h.append(g),d.append(h)):d.append(g),d.append(f.clone()))}}),d.children().last().remove(),d.hide(),e.hide(),a.menuDisplayShow=!1,g.append(d),a.showMenu=!1,g.append(e)}}),window.___E_mod(function(a,b){a.fn.bindDocumentEvent=function(){var a=b(document),c=this,d=(c.$txt,Date.now());a.on("scroll",function(a){Date.now()-d<=50||(d=Date.now(),c.hideMenuContainer())}),a.on("tap",function(a){})}}),window.___E_mod(function(a,b){a.fn.bindTxtEvent=function(){function a(){var a,d;c.saveSelection(),a=c.getWrapRangeElem(),a&&(d=b(a),d.addClass("focus-elem"),c.$focusElem=d),c.updateMenuStyle()}var c=this,d=c.$txt,e=Date.now();d.on("focus",function(){c.isFocus=!0}),d.on("touchstart",function(a){c.touchEvent=a}),d.on("singleTap",function(d){if(c.checkTapTime()!==!1&&c.isFocus){var e=b(d.target);if(c.eventTarget(e),e.hasClass("focus-elem"))return void c.hideMenuContainer();c.setMenuContainerPosition(c.touchEvent);var f=c.$focusElem;f&&f.removeClass("focus-elem"),setTimeout(a,c.txtTapDelay),c.txtTapDelay=100,d.stopPropagation()}}),d.on("scroll",function(a){Date.now()-e<=50||(e=Date.now(),c.hideMenuContainer(),a.stopPropagation())}),d.on("keydown",function(a){c.hideMenuContainer()}),d.on("longTap, doubleTap",function(){c.hideMenuContainer()}),d.on("blur",function(a){return null!=a.relatedTarget?(a.preventDefault(),void d.focus()):(c.isFocus=!1,c.saveSourceCode(),void c.hideMenuContainer())}),d.on("click",function(a){a.preventDefault(),a.stopPropagation()})}}),window.___E_mod(function(a,b){a.fn.bindMenuContainerEvent=function(){var a=this,b=a.$menuContainer,c=a.$menuClose;b.on("tap",function(a){a.preventDefault(),a.stopPropagation()}),c.on("singleTap",function(b){a.checkTapTime()!==!1&&(a.hideMenuByOpenBtn(),b.preventDefault(),b.stopPropagation())})},a.fn.bindMenuContainerOpenBtnEvent=function(){var a=this,b=a.$menuContainerOpenBtn;a.$menuContainer;b.find("a").on("singleTap",function(b){a.checkTapTime()!==!1&&(a.showMenuByOpenBtn(),b.preventDefault(),b.stopPropagation())})}}),window.___E_mod(function(a,b){a.fn.bindMenuBtnEvent=function(){var a=this,c=a.menus;b.each(c,function(b,c){var d=c.bindEvent;d&&"function"==typeof d&&d.call(c,a)})}}),window.___E_mod(function(a,b){a.fn.focusTxt=function(){var a=this,b=a.$txt;b.focus()},a.fn.eventTarget=function(a){var b=this;return null==a?b.$eventTargetElem:void(b.$eventTargetElem=a)},a.fn.saveSourceCode=function(){var a=this,b=a.$txt,c=a.$textarea,d="",e=b.clone(),f=e.find(".focus-elem");f.removeClass("focus-elem"),d=e.html(),c.val(d)},a.fn.insertEmpltyLink=function(){var a=this,c=a.$txt,d=c.children();return 0===d.length?void c.append(b("<p><br></p>")):void("<br>"!==d.last().html()&&c.append(b("<p><br></p>")))}}),window.___E_mod(function(a,b){a.fn.setMenuContainerPosition=function(a){var c=this,d=c.eventTarget(),e=a.pageY,f=d.offset(),g=f.top,h=f.height;0===e&&(e=g+h);var i=c.$txt,j=i.offset(),k=j.top,l=j.left,m=j.height;e>k+m&&(e=k+m-10);var n,o=i.children();0===o.length?(n=b("<p><br></p>"),i.append(n)):n=o.last();var p=n.offset(),q=p.top,r=p.height,s=c.$menuContainer,t=c.$menuContainerOpenBtn,u=e;u>q+r&&(u=q+r);var v=l+3,w=20,x={top:u+"px",left:v+"px","margin-top":w+"px"};s.css(x),t.css(x),c.showMenuContainer()},a.fn.showMenuContainer=function(){var a=this,b=a.$menuContainer,c=a.$menuContainerOpenBtn;a.menuDisplayShow===!1&&(a.showMenu?(b.show(),b.css("opacity","0.9")):(c.show(),c.css("opacity","0.6")),a.menuDisplayShow=!0)},a.fn.hideMenuContainer=function(){var a=this,b=a.$menuContainer,c=a.$menuContainerOpenBtn,d=a.$txt,e=a.$focusElem,f=d.find(".focus-elem");a.menuDisplayShow&&(c.hide(),c.css("opacity","0"),b.hide(),b.css("opacity","0"),a.menuDisplayShow=!1,e&&(e.removeClass("focus-elem"),f.removeClass("focus-elem")))},a.fn.showMenuByOpenBtn=function(){var a=this,b=a.$menuContainer,c=a.$menuContainerOpenBtn;a.showMenu=!0,b.show(),b.css("opacity","0.9"),c.hide(),c.css("opacity","0")},a.fn.hideMenuByOpenBtn=function(){var a=this;a.$menuContainer,a.$menuContainerOpenBtn;a.showMenu=!1,a.hideMenuContainer()}}),window.___E_mod(function(a,b){a.fn.updateMenuStyle=function(){var a=this,c=a.menus;b.each(c,function(a,b){var c=b.updateStyle;c&&c.call(b)})}}),window.___E_mod(function(a,b){a.fn.command=function(a,b,c,d,e){var f=this,g=function(){document.execCommand(a,!!b,c)};f.customCommand(g,d,e)},a.fn.customCommand=function(a,b,c){var d=this,e=d.currentRange(),f=d.currentWrapRange();d.$txt;d.restoreSelection(f),a(),d.insertEmpltyLink(),d.saveSelection(),d.restoreSelection(e),b&&(b.preventDefault(),b.stopPropagation()),c&&c.call(d),d.hideMenuContainer()}}),window.___E_mod(function(a,b){a.fn.currentRange=function(a){return a?void(this.currentRangeData=a):this.currentRangeData},a.fn.currentWrapRange=function(a){return a?void(this.currentWrapRangeData=a):this.currentWrapRangeData},a.fn.getWrapRangeElem=function(){var a,b,c=this,d=c.$txt,e=d.attr("class"),f=this.currentWrapRange();c.eventTarget().get(0);return null!=f?(a=f.commonAncestorContainer,b=3===a.nodeType?a.parentNode:a,b.className===e&&(b=d.children().last().get(0)||b),b):void 0},a.fn.saveSelection=function(a){var b,c,d,e=this,f=e.$txt.get(0);a?b=a.commonAncestorContainer:(c=document.getSelection(),c.getRangeAt&&c.rangeCount&&(a=document.getSelection().getRangeAt(0),b=a.commonAncestorContainer)),b&&(f.contains(b)||f===b)&&(e.currentRange(a),d=document.getSelection().getRangeAt(0),d.selectNodeContents(b),e.currentWrapRange(d))},a.fn.restoreSelection=function(a){var b;a&&(b=document.getSelection(),b.removeAllRanges(),b.addRange(a))}}),window.___E_mod(function(a,b){}),window.___E_mod(function(a,b){a.fn.init=function(){var a=this;a.renderTxt(),a.renderMenu(),a.bindDocumentEvent(),a.bindTxtEvent(),a.bindMenuBtnEvent(),a.bindMenuContainerEvent(),a.bindMenuContainerOpenBtnEvent()}});